<!DOCTYPE html>
<!--
  Grade 12 Physics Solver
  This is a web application that helps students solve physics problems from different units.
-->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Grade 12 Physics Solver</title>
  <!-- Google Fonts for modern, clean text style -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <!-- Chart.js library for drawing graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --accent: #38bdf8;
      --bg: #f8fafc;
      --bg-dark: #18181b;
      --surface: #fff;
      --surface-dark: #23272f;
      --text: #22223b;
      --text-light: #f4f4f5;
      --border: #e5e7eb;
      --shadow: 0 4px 24px 0 rgba(30,64,175,0.08);
      --radius: 18px;
      --transition: 0.2s cubic-bezier(.4,0,.2,1);
    }
    * { box-sizing: border-box; }
    html, body {
      height: 110%;
      min-height: 100vh;
      margin: 0;
      padding: 0;
      font-family: 'Inter', 'Roboto', Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background var(--transition), color var(--transition);
    }
    body.dark, body.dark html {
      background: var(--bg-dark) !important;
      color: var(--text-light) !important;
    }
    /* Header styles */
    header {
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: #fff;
      padding: 2.5rem 1rem 2rem 1rem;
      text-align: center;
      font-size: 2.2rem;
      font-weight: 700;
      letter-spacing: 0.01em;
      border-bottom-left-radius: var(--radius);
      border-bottom-right-radius: var(--radius);
      box-shadow: var(--shadow);
      position: relative;
      margin-bottom: 2rem;
    }
    body.dark header {
      background: linear-gradient(90deg, #0f172a, #2563eb 80%);
      color: #f4f4f5;
    }
    /* Dark mode toggle button */
    #darkModeToggle {
      position: absolute;
      top: 18px;
      right: 24px;
      background: rgba(255,255,255,0.12);
      border: none;
      color: #fff;
      border-radius: 50px;
      padding: 0.5rem 1.2rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 8px 0 rgba(30,64,175,0.08);
      transition: background var(--transition), color var(--transition);
    }
    body.dark #darkModeToggle {
      background: rgba(30,64,175,0.25);
      color: #f4f4f5;
    }
    /* Main content area - take up 75% of the screen, centered, with padding */
    main {
      max-width: 75vw;
      min-width: 320px;
      margin: 2.5rem auto;
      background: var(--surface);
      border-radius: var(--radius);
      padding: 2.5rem 2.5vw 2.5rem 2.5vw;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      transition: background var(--transition), color var(--transition);
      min-height: 80vh;
    }
    body.dark main {
      background: var(--surface-dark);
      color: var(--text-light);
    }
    /* Homepage welcome section */
    #homepage {
      text-align: center;
      animation: fadeIn 0.6s ease-out;
      background: none;
      box-shadow: none;
      padding: 2.2rem 1rem 2rem 1rem;
    }
    #homepage h2 {
      font-size: 2.1rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      letter-spacing: 0.01em;
    }
    #homepage p {
      font-size: 1.15rem;
      color: #64748b;
      margin-bottom: 0.5rem;
    }
    body.dark #homepage p {
      color: #cbd5e1;
    }
    #start-btn {
      margin-top: 2rem;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: #fff;
      border: none;
      padding: 0.65rem 1.1rem;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 30px;
      cursor: pointer;
      min-width: 120px;
      box-shadow: 0 2px 12px 0 rgba(56,189,248,0.10);
      transition: background var(--transition), box-shadow var(--transition);
    }
    #start-btn:hover {
      background: linear-gradient(90deg, var(--primary-dark), var(--primary));
      box-shadow: 0 4px 20px 0 rgba(56,189,248,0.18);
    }
    /* Navigation bar styles */
    nav {
      display: flex;
      justify-content: center;
      background: none;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 2.2rem;
      box-shadow: none;
    }
    nav button {
      background: var(--bg);
      color: var(--primary);
      border: 1.5px solid var(--border);
      padding: 0.7rem 1.2rem;
      border-radius: 50px;
      font-size: 1.05rem;
      font-weight: 600;
      cursor: pointer;
      margin: 0.2rem 0.1rem;
      transition: background var(--transition), color var(--transition), border var(--transition);
      outline: none;
    }
    nav button:hover, nav button:focus, nav button.active {
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: #fff;
      border: 1.5px solid var(--primary);
    }
    body.dark nav button {
      background: #23272f;
      color: #60a5fa;
      border: 1.5px solid #334155;
    }
    body.dark nav button:hover, body.dark nav button:focus, body.dark nav button.active {
      background: linear-gradient(90deg, #1e293b, #2563eb);
      color: #fff;
      border: 1.5px solid #2563eb;
    }
    /* Section styles */
    .section {
      display: none;
      animation: fadeIn 0.5s ease-out;
      padding-top: 0.2rem;
      margin-bottom: 1.2rem;
    }
    .active {
      display: block;
    }
    /* Section headings */
    section h2 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1.2rem;
      color: var(--primary);
      letter-spacing: 0.01em;
    }
    body.dark section h2 {
      color: #38bdf8;
    }
    /* Form labels and input fields */
    label {
      display: block;
      margin-top: 0.7rem;
      font-weight: 600;
      font-size: 1rem;
      color: #334155;
    }
    body.dark label {
      color: #cbd5e1;
    }
    input, select {
      width: 100%;
      padding: 0.5rem 0.7rem;
      font-size: 1rem;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      margin-top: 0.25rem;
      background: var(--bg);
      color: var(--text);
      transition: border-color var(--transition), background var(--transition), color var(--transition);
    }
    input:focus, select:focus {
      border-color: var(--primary);
      outline: none;
      background: #e0e7ef;
    }
    body.dark input, body.dark select {
      background: #23272f;
      color: #f4f4f5;
      border: 1.5px solid #334155;
    }
    body.dark input:focus, body.dark select:focus {
      background: #18181b;
      border-color: #38bdf8;
    }
    /* Main buttons */
    button.solve-btn {
      margin-top: 1rem;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: #fff;
      border: none;
      padding: 0.65rem 1.1rem;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 30px;
      cursor: pointer;
      min-width: 120px;
      width: auto;
      box-shadow: 0 2px 8px 0 rgba(56,189,248,0.08);
      transition: background var(--transition), box-shadow var(--transition);
    }
    button.solve-btn:hover {
      background: linear-gradient(90deg, var(--primary-dark), var(--primary));
      box-shadow: 0 4px 20px 0 rgba(56,189,248,0.16);
    }
    /* Result box styles */
    .result {
      margin-top: 1rem;
      font-size: 1.05rem;
      background: #f1f5f9;
      padding: 0.7rem 0.8rem;
      border-left: 5px solid var(--primary);
      border-radius: 8px;
      white-space: pre-wrap;
      min-height: 36px;
      color: #22223b;
      box-shadow: 0 2px 8px 0 rgba(30,64,175,0.04);
      transition: background var(--transition), color var(--transition);
    }
    body.dark .result {
      background: #23272f;
      color: #f4f4f5;
      border-left: 5px solid #38bdf8;
    }
    /* Toggle “Don’t Know” button and section */
    #dont-know-toggle {
      margin-top: 1rem;
      cursor: pointer;
      color: var(--primary);
      text-decoration: underline;
      background: none;
      border: none;
      font-weight: 600;
      font-size: 1.05rem;
      transition: color var(--transition);
    }
    #dont-know-toggle:hover {
      color: var(--accent);
    }
    #dont-know-section {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1.5px solid var(--border);
      display: none;
      background: #f8fafc;
      border-radius: 10px;
      box-shadow: 0 2px 8px 0 rgba(56,189,248,0.04);
    }
    body.dark #dont-know-section {
      background: #23272f;
      border-top: 1.5px solid #334155;
    }
    /* Graph section and canvas styles */
    #graphing {
      max-width: 600px;
      margin: 0 auto;
      padding: 1.2rem 0.5rem 1.5rem 0.5rem;
      border-radius: 14px;
      background: #f8fafc;
      box-shadow: 0 2px 8px 0 rgba(56,189,248,0.04);
    }
    body.dark #graphing {
      background: #23272f;
    }
    #graphCanvas {
      max-width: 100%;
      width: 400px !important;
      height: 240px !important;
      margin: 0.7rem auto 0 auto;
      display: block;
      background: #f1f5f9;
      border-radius: 10px;
      box-shadow: 0 2px 8px 0 rgba(56,189,248,0.04);
    }
    body.dark #graphCanvas {
      background: #23272f;
    }
    /* Bottom panel for result formatting and step-by-step options */
    #result-settings {
      margin: 1.5rem auto 0;
      max-width: 480px;
      background: #f1f5f9;
      padding: 0.7rem 0.7rem;
      border-radius: 10px;
      box-shadow: 0 2px 8px 0 rgba(30,64,175,0.04);
      text-align: center;
      font-size: 0.97rem;
      color: #334155;
      transition: background var(--transition), color var(--transition);
    }
    body.dark #result-settings {
      background: #23272f;
      color: #f4f4f5;
    }
    #sigfig-container { margin-top: 0.5rem; display: none; }
    #step-settings { margin-top: 0.5rem; }
    /* Animation for fading in sections */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px);}
      to   { opacity: 1; transform: translateY(0);}
    }
    /* Responsive for mobile */
    @media (max-width: 900px) {
      main {
        max-width: 98vw;
        padding: 0.7rem 0.2rem;
      }
      #graphing {
        max-width: 98vw;
        padding: 0.7rem 0.2rem;
      }
      #graphCanvas {
        width: 98vw !important;
        min-width: 180px;
        height: 160px !important;
      }
    }
    @media (max-width: 600px) {
      main {
        max-width: 99vw;
        padding: 0.7rem 0.2rem;
      }
      #homepage {
        padding: 1.2rem 0.2rem 1rem 0.2rem;
      }
      #graphing {
        max-width: 99vw;
        padding: 0.7rem 0.2rem;
      }
      #graphCanvas {
        width: 99vw !important;
        min-width: 120px;
        height: 120px !important;
      }
      nav {
        gap: 0.2rem;
      }
      nav button {
        font-size: 0.97rem;
        padding: 0.6rem 0.7rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header at the top of the page -->
  <header>
    Grade 12 Physics Solver
    <!-- Button to switch between dark and light mode -->
    <button id="darkModeToggle">Dark Mode</button>
  </header>

  <!-- Homepage: Welcome screen shown at first -->
  <main id="homepage">
    <h2>Welcome to the Physics Solver</h2>
    <p>This program helps you solve problems from multiple units we have covered in the course.</p>
    <p style="font-size:1.05rem; color:#2563eb; font-weight:600; margin-bottom:2.2rem;">By Abel Alexander</p>
    <!-- Button to start using the app -->
    <button id="start-btn">Start Solving Physics Problems</button>
  </main>

  <!-- Main App: Hidden at first, shown after clicking Start -->
  <main id="app" style="display:none;">
    <!-- Choose Unit Screen -->
    <div id="choose-unit-screen" style="text-align:center;">
      <h2>Select a Unit or Tool to Begin</h2>
      <nav style="justify-content:center;">
        <button onclick="chooseUnit('kinematics')">Kinematics</button>
        <button onclick="chooseUnit('energy')">Energy &amp; Momentum</button>
        <button onclick="chooseUnit('fields')">Fields</button>
        <button onclick="chooseUnit('waves')">Waves</button>
        <button onclick="chooseUnit('modern')">Modern Physics</button>
        <button onclick="chooseUnit('graphing')">Graphing</button>
        <button onclick="chooseUnit('converter')">Converter</button>
        <button onclick="chooseUnit('practice')">Practice</button>
      </nav>
    </div>
    <!-- Navigation bar: lets you pick which section to use (hidden until a unit is chosen) -->
    <nav id="main-nav" style="display:none;">
      <button onclick="showSection('kinematics')">Kinematics</button>
      <button onclick="showSection('energy')">Energy &amp; Momentum</button>
      <button onclick="showSection('fields')">Fields</button>
      <button onclick="showSection('waves')">Waves</button>
      <button onclick="showSection('modern')">Modern Physics</button>
      <button onclick="showSection('graphing')">Graphing</button>
      <button onclick="showSection('converter')">Converter</button>
      <button onclick="showSection('practice')">Practice</button>
    </nav>

    <!-- Kinematics Solver Section -->
    <section id="kinematics" class="section">
      <h2>Kinematics Solver</h2>
      <label for="solve-for">Solve for:</label>
      <select id="solve-for" onchange="updateKinematicsInputs()">
        <option value="v">Final Velocity (v)</option>
        <option value="v0">Initial Velocity (v₀)</option>
        <option value="a">Acceleration (a)</option>
        <option value="t">Time (t)</option>
        <option value="d">Displacement (d)</option>
      </select>
      <div id="kin-input-fields"></div>
      <button class="solve-btn" onclick="solveKinematics()">Calculate</button>
      <button id="dont-know-toggle" onclick="toggleDontKnow()">
        Don't know? Enter known values and we'll try to solve.
      </button>
      <div id="dont-know-section">
        <label>Initial Velocity (v₀ in m/s): <input type="number" id="dk-v0" placeholder="Leave blank if unknown"></label>
        <label>Final Velocity (v in m/s): <input type="number" id="dk-v" placeholder="Leave blank if unknown"></label>
        <label>Acceleration (a in m/s²): <input type="number" id="dk-a" placeholder="Leave blank if unknown"></label>
        <label>Time (t in s): <input type="number" id="dk-t" placeholder="Leave blank if unknown"></label>
        <label>Displacement (d in m): <input type="number" id="dk-d" placeholder="Leave blank if unknown"></label>
        <button class="solve-btn" onclick="solveDontKnow()">Try Solve</button>
        <div class="result" id="dk-result"></div>
      </div>
      <div class="result" id="kinResult"></div>
    </section>

    <!-- Energy & Momentum Solver Section -->
    <section id="energy" class="section">
      <h2>Energy &amp; Momentum Solver</h2>
      <label for="solve-energy">Solve for:</label>
      <select id="solve-energy" onchange="updateEnergyInputs()">
        <option value="ke">Kinetic Energy (KE)</option>
        <option value="pe">Potential Energy (PE)</option>
        <option value="p">Momentum (p)</option>
        <option value="impulse">Impulse (J)</option>
      </select>
      <div id="energy-input-fields"></div>
      <button class="solve-btn" onclick="solveEnergyMomentum()">Calculate</button>
      <div class="result" id="energyResult"></div>
    </section>

    <!-- Fields Solver Section -->
    <section id="fields" class="section">
      <h2>Fields Solver</h2>
      <label for="solve-fields">Solve for:</label>
      <select id="solve-fields" onchange="updateFieldsInputs()">
        <option value="grav">Gravitational Force (F)</option>
        <option value="elec">Electric Field (E)</option>
      </select>
      <div id="fields-input-fields"></div>
      <button class="solve-btn" onclick="solveFields()">Calculate</button>
      <div class="result" id="fieldsResult"></div>
    </section>

    <!-- Waves Solver Section -->
    <section id="waves" class="section">
      <h2>Waves Solver</h2>
      <label for="solve-waves">Solve for:</label>
      <select id="solve-waves" onchange="updateWavesInputs()">
        <option value="v">Wave Speed (v)</option>
        <option value="f">Frequency (f)</option>
        <option value="wavelength">Wavelength (λ)</option>
      </select>
      <div id="waves-input-fields"></div>
      <button class="solve-btn" onclick="solveWaves()">Calculate</button>
      <div class="result" id="wavesResult"></div>
    </section>

    <!-- Modern Physics Solver Section -->
    <section id="modern" class="section">
      <h2>Modern Physics Solver</h2>
      <label for="solve-modern">Solve for:</label>
      <select id="solve-modern" onchange="updateModernInputs()">
        <option value="rke">Relativistic Kinetic Energy (K)</option>
        <option value="re">Rest Energy (E)</option>
      </select>
      <div id="modern-input-fields"></div>
      <button class="solve-btn" onclick="solveModern()">Calculate</button>
      <div class="result" id="modernResult"></div>
    </section>

    <!-- Graphing Section -->
    <section id="graphing" class="section">
      <h2>Graphing</h2>
      <label for="graph-type">Graph Type:</label>
      <select id="graph-type">
        <option value="vt">Velocity-Time Graph</option>
        <option value="at">Acceleration-Time Graph</option>
        <option value="pt">Position-Time Graph</option>
      </select>
      <p>Enter comma-separated values for time and corresponding velocity values:</p>
      <label>Time Values (s): <input type="text" id="graph-time" placeholder="e.g., 0,1,2,3"></label>
      <label>Velocity Values (m/s): <input type="text" id="graph-value" placeholder="e.g., 0,5,10,15"></label>
      <button class="solve-btn" onclick="plotGraph()">Plot Graph</button>
      <canvas id="graphCanvas"></canvas>
    </section>

    <!-- Unit Converter Section -->
    <section id="converter" class="section">
      <h2>Unit Converter</h2>
      <label for="conversion-type">Conversion Category:</label>
      <select id="conversion-type" onchange="updateConverterInputs()">
        <option value="speed">Speed (km/hr ↔ m/s)</option>
        <option value="distance">Distance (km, m, mi, ft)</option>
        <option value="temperature">Temperature (°C, °F, K)</option>
        <option value="energy">Energy (J, eV, cal, Wh)</option>
        <option value="mass">Mass (kg, lb, g, oz)</option>
        <option value="volume">Volume (L, m³, gal)</option>
        <option value="pressure">Pressure (kPa, atm, psi)</option>
        <option value="force">Force (N, kgf)</option>
        <option value="power">Power (W, hp)</option>
        <option value="area">Area (m², ft², km², mi²)</option>
      </select>
      <div id="converter-input-fields"></div>
      <button class="solve-btn" onclick="performConversion()">Convert</button>
      <div class="result" id="converterResult"></div>
    </section>

    <!-- Practice/Quiz Section -->
    <section id="practice" class="section">
      <h2>Practice Mode / Quiz</h2>
      <label for="practice-category">Select Unit:</label>
      <select id="practice-category">
        <option value="kinematics">Kinematics</option>
        <option value="energy">Energy &amp; Momentum</option>
        <option value="fields">Fields</option>
        <option value="waves">Waves</option>
        <option value="modern">Modern Physics</option>
      </select>
      <button class="solve-btn" onclick="generatePracticeProblem()">Generate Practice Problem</button>
      <div id="practice-problem" style="margin-top:1rem;"></div>
      <label>Your Answer: <input type="number" id="practice-answer"></label>
      <button class="solve-btn" onclick="checkPracticeAnswer()">Submit Answer</button>
      <div class="result" id="practice-result"></div>
    </section>

    <!-- Bottom Panel: Settings for result formatting and step-by-step explanations -->
    <div id="result-settings">
      <label for="result-format">Result Format:</label>
      <select id="result-format" onchange="updateFormatSettings()">
        <option value="decimal">Decimal (2 dp)</option>
        <option value="sigfig">Significant Figures</option>
      </select>
      <div id="sigfig-container">
        <label for="num-sigfigs">
          Number of Significant Figures:
          <input type="number" id="num-sigfigs" value="3" min="1" style="width: 60px;">
        </label>
      </div>
      <!-- Option to include step-by-step explanations -->
      <div id="step-settings">
        <label>
          <input type="checkbox" id="show-steps" onchange="toggleStepExplanation()">
          Include Step-by-Step Explanation
        </label>
      </div>
    </div>
  </main>

  <script>
    // === GLOBAL VARIABLES ===
    let resultFormat = "decimal";
    let chart, includeSteps = false;
    let currentProblem = {};

    // === FORMAT SETTINGS ===
    function updateFormatSettings() {
      resultFormat = document.getElementById("result-format").value;
      document.getElementById("sigfig-container").style.display =
        (resultFormat === "sigfig") ? "block" : "none";
    }
    function toggleStepExplanation() {
      includeSteps = document.getElementById("show-steps").checked;
    }
    function formatNumber(num) {
      if (isNaN(num)) return "NaN";
      if (resultFormat === "decimal") return parseFloat(num).toFixed(2);
      const sig = parseInt(document.getElementById("num-sigfigs").value) || 3;
      return parseFloat(num).toPrecision(sig);
    }

    // === DARK MODE TOGGLE ===
    document.getElementById("darkModeToggle").onclick = () => {
      document.body.classList.toggle("dark");
      document.getElementById("darkModeToggle").innerText =
        document.body.classList.contains("dark") ? "Light Mode" : "Dark Mode";
    };

    // === START BUTTON ===
    document.getElementById("start-btn").onclick = () => {
      document.getElementById("homepage").style.animation = "fadeOut 0.5s forwards";
      setTimeout(() => {
        document.getElementById("homepage").style.display = "none";
        document.getElementById("app").style.display      = "block";
        // Show choose unit screen, hide everything else
        document.getElementById("choose-unit-screen").style.display = "block";
        document.getElementById("main-nav").style.display = "none";
        document.querySelectorAll(".section").forEach(s=>s.style.display="none");
        document.getElementById("result-settings").style.display = "none";
      }, 500);
    };

    // === CHOOSE UNIT SCREEN LOGIC ===
    function chooseUnit(id) {
      // Hide choose unit screen, show nav and section
      document.getElementById("choose-unit-screen").style.display = "none";
      document.getElementById("main-nav").style.display = "flex";
      showSection(id);
    }

    // === SECTION NAVIGATION ===
    function showSection(id) {
      // Hide all sections, then show the one selected
      document.querySelectorAll(".section").forEach(s=>{
        s.classList.remove("active");
        s.style.display = "none";
      });
      document.getElementById(id).classList.add("active");
      document.getElementById(id).style.display = "block";

      // Clear all result boxes
      ["kinResult","dk-result","energyResult","fieldsResult",
       "wavesResult","modernResult","converterResult","practice-result"
      ].forEach(i => document.getElementById(i).innerText = "");
      document.getElementById("practice-problem").innerText = "";

      // Hide bottom panel for graphing, show for others
      document.getElementById("result-settings").style.display =
        (id === "graphing") ? "none" : "block";

      // Hide step-by-step for converter/practice, show for others
      const stepDiv = document.getElementById("step-settings");
      if (id === "converter" || id === "practice") {
        stepDiv.style.display = "none";
        document.getElementById("show-steps").checked = false;
        includeSteps = false;
      } else {
        stepDiv.style.display = "block";
      }

      // Initialize input fields for the selected section
      if (id==="kinematics") updateKinematicsInputs();
      if (id==="energy")      updateEnergyInputs();
      if (id==="fields")      updateFieldsInputs();
      if (id==="waves")       updateWavesInputs();
      if (id==="modern")      updateModernInputs();
      if (id==="converter")   updateConverterInputs();
    }

    /////////////////////////////
    // KINEMATICS SOLVER LOGIC //
    /////////////////////////////
    function updateKinematicsInputs() {
      const solveFor = document.getElementById("solve-for").value;
      const div = document.getElementById("kin-input-fields");
      div.innerHTML = "";
      const vars = ["v0","v","a","t","d"].filter(v=>v!==solveFor);
      const names = {
        v0:"Initial Velocity (m/s)",
        v: "Final Velocity (m/s)",
        a: "Acceleration (m/s²)",
        t: "Time (s)",
        d: "Displacement (m)"
      };
      vars.forEach(v => {
        div.innerHTML += `<label>${names[v]}<input type="number" id="input-${v}" required></label>`;
      });
    }
    function solveKinematics() {
      const solveFor = document.getElementById("solve-for").value;
      let inputs = {}, abort=false;
      ["v0","v","a","t","d"].forEach(k=>{
        if(k!==solveFor){
          const val = parseFloat(document.getElementById(`input-${k}`).value);
          if(isNaN(val)){ alert(`Enter ${k}`); abort=true; }
          inputs[k]=val;
        }
      });
      if(abort) return;
      let res="", exp="";
      try {
        switch(solveFor) {
          case "v": {
            var out = inputs.v0 + inputs.a*inputs.t;
            res = `v = ${inputs.v0} + ${inputs.a}×${inputs.t} = ${formatNumber(out)} m/s`;
            if (includeSteps) {
              exp =
`Step 1: Write the kinematic equation for final velocity:
    v = v₀ + a·t

Step 2: Identify the known values:
    v₀ = ${inputs.v0} m/s (initial velocity)
    a = ${inputs.a} m/s² (acceleration)
    t = ${inputs.t} s (time)

Step 3: Substitute the values into the equation:
    v = ${inputs.v0} + (${inputs.a}) × (${inputs.t})

Step 4: Calculate acceleration × time:
    a·t = ${inputs.a} × ${inputs.t} = ${inputs.a*inputs.t}

Step 5: Add initial velocity:
    v = ${inputs.v0} + ${inputs.a*inputs.t} = ${out}

Step 6: Final answer:
    v = ${formatNumber(out)} m/s`;
            }
            break;
          }
          case "v0": {
            var out = inputs.v - inputs.a*inputs.t;
            res = `v₀ = ${inputs.v} - ${inputs.a}×${inputs.t} = ${formatNumber(out)} m/s`;
            if (includeSteps) {
              exp =
`Step 1: Rearrange the kinematic equation for initial velocity:
    v₀ = v - a·t

Step 2: Identify the known values:
    v = ${inputs.v} m/s (final velocity)
    a = ${inputs.a} m/s² (acceleration)
    t = ${inputs.t} s (time)

Step 3: Substitute the values:
    v₀ = ${inputs.v} - (${inputs.a}) × (${inputs.t})

Step 4: Calculate acceleration × time:
    a·t = ${inputs.a} × ${inputs.t} = ${inputs.a*inputs.t}

Step 5: Subtract from final velocity:
    v₀ = ${inputs.v} - ${inputs.a*inputs.t} = ${out}

Step 6: Final answer:
    v₀ = ${formatNumber(out)} m/s`;
            }
            break;
          }
          case "a": {
            if(inputs.t===0) throw "t=0";
            var out = (inputs.v - inputs.v0)/inputs.t;
            res = `a = (${inputs.v}-${inputs.v0})/${inputs.t} = ${formatNumber(out)} m/s²`;
            if (includeSteps) {
              exp =
`Step 1: Rearrange the kinematic equation for acceleration:
    a = (v - v₀) / t

Step 2: Identify the known values:
    v = ${inputs.v} m/s (final velocity)
    v₀ = ${inputs.v0} m/s (initial velocity)
    t = ${inputs.t} s (time)

Step 3: Substitute the values:
    a = (${inputs.v} - ${inputs.v0}) / ${inputs.t}

Step 4: Calculate numerator:
    v - v₀ = ${inputs.v} - ${inputs.v0} = ${inputs.v-inputs.v0}

Step 5: Divide by time:
    a = ${inputs.v-inputs.v0} / ${inputs.t} = ${out}

Step 6: Final answer:
    a = ${formatNumber(out)} m/s²`;
            }
            break;
          }
          case "t": {
            if(inputs.a===0) throw "a=0";
            var out = (inputs.v - inputs.v0)/inputs.a;
            res = `t = (${inputs.v}-${inputs.v0})/${inputs.a} = ${formatNumber(out)} s`;
            if (includeSteps) {
              exp =
`Step 1: Rearrange the kinematic equation for time:
    t = (v - v₀) / a

Step 2: Identify the known values:
    v = ${inputs.v} m/s (final velocity)
    v₀ = ${inputs.v0} m/s (initial velocity)
    a = ${inputs.a} m/s² (acceleration)

Step 3: Substitute the values:
    t = (${inputs.v} - ${inputs.v0}) / ${inputs.a}

Step 4: Calculate numerator:
    v - v₀ = ${inputs.v} - ${inputs.v0} = ${inputs.v-inputs.v0}

Step 5: Divide by acceleration:
    t = ${inputs.v-inputs.v0} / ${inputs.a} = ${out}

Step 6: Final answer:
    t = ${formatNumber(out)} s`;
            }
            break;
          }
          case "d": {
            var out = inputs.v0*inputs.t + 0.5*inputs.a*Math.pow(inputs.t,2);
            res = `d = ${inputs.v0}×${inputs.t} + 0.5×${inputs.a}×${inputs.t}² = ${formatNumber(out)} m`;
            if (includeSteps) {
              exp =
`Step 1: Write the kinematic equation for displacement:
    d = v₀·t + ½·a·t²

Step 2: Identify the known values:
    v₀ = ${inputs.v0} m/s (initial velocity)
    a = ${inputs.a} m/s² (acceleration)
    t = ${inputs.t} s (time)

Step 3: Substitute the values:
    d = (${inputs.v0}) × (${inputs.t}) + 0.5 × (${inputs.a}) × (${inputs.t})²

Step 4: Calculate v₀·t:
    v₀·t = ${inputs.v0} × ${inputs.t} = ${inputs.v0*inputs.t}

Step 5: Calculate 0.5·a·t²:
    t² = ${inputs.t}² = ${Math.pow(inputs.t,2)}
    0.5·a·t² = 0.5 × ${inputs.a} × ${Math.pow(inputs.t,2)} = ${0.5*inputs.a*Math.pow(inputs.t,2)}

Step 6: Add both terms:
    d = ${inputs.v0*inputs.t} + ${0.5*inputs.a*Math.pow(inputs.t,2)} = ${out}

Step 7: Final answer:
    d = ${formatNumber(out)} m`;
            }
            break;
          }
        }
      } catch(e){ res="Error: "+e; }
      document.getElementById("kinResult").innerText =
        includeSteps && exp ? res+"\n\n"+exp : res;
    }
    function toggleDontKnow() {
      const sec = document.getElementById("dont-know-section");
      sec.style.display = (sec.style.display==="block") ? "none" : "block";
    }
    function solveDontKnow() {
      const v0=parseFloat(document.getElementById("dk-v0").value),
            v =parseFloat(document.getElementById("dk-v").value),
            a =parseFloat(document.getElementById("dk-a").value),
            t =parseFloat(document.getElementById("dk-t").value),
            d =parseFloat(document.getElementById("dk-d").value);
      const known={v0,v,a,t,d};
      const filled=Object.values(known).filter(x=>!isNaN(x)).length;
      if(filled<3){ document.getElementById("dk-result").innerText="Enter≥3 values."; return; }
      const missing=Object.entries(known).filter(([k,val])=>isNaN(val)).map(([k])=>k);
      if(missing.length!==1){
        document.getElementById("dk-result").innerText="Leave one blank."; return;
      }
      let ans=NaN, x=missing[0], exp="";
      try{
        switch(x){
          case "v":
            if(!isNaN(v0)&&!isNaN(a)&&!isNaN(t)) {
              ans=v0+a*t;
              if(includeSteps) exp =
`Step 1: Use v = v₀ + a·t
Step 2: Substitute: v = ${v0} + ${a}×${t}
Step 3: Calculate: v = ${v0+a*t}`;
            }
            else if(!isNaN(d)&&!isNaN(v0)&&!isNaN(a)) {
              ans=Math.sqrt(v0*v0+2*a*d);
              if(includeSteps) exp =
`Step 1: Use v² = v₀² + 2a·d
Step 2: Substitute: v² = ${v0}² + 2×${a}×${d}
Step 3: Calculate: v² = ${v0*v0} + ${2*a*d} = ${v0*v0+2*a*d}
Step 4: Take square root: v = √${v0*v0+2*a*d} = ${ans}`;
            }
            break;
          case "v0":
            if(!isNaN(v)&&!isNaN(a)&&!isNaN(t)) {
              ans=v - a*t;
              if(includeSteps) exp =
`Step 1: Use v₀ = v - a·t
Step 2: Substitute: v₀ = ${v} - ${a}×${t}
Step 3: Calculate: v₀ = ${v-a*t}`;
            }
            else if(!isNaN(v)&&!isNaN(d)&&!isNaN(a)) {
              ans=Math.sqrt(v*v-2*a*d);
              if(includeSteps) exp =
`Step 1: Use v² = v₀² + 2a·d, rearrange for v₀
Step 2: v₀² = v² - 2a·d
Step 3: Substitute: v₀² = ${v}² - 2×${a}×${d}
Step 4: Calculate: v₀² = ${v*v} - ${2*a*d} = ${v*v-2*a*d}
Step 5: Take square root: v₀ = √${v*v-2*a*d} = ${ans}`;
            }
            break;
          case "a":
            if(!isNaN(v)&&!isNaN(v0)&&!isNaN(t)&&t!==0) {
              ans=(v-v0)/t;
              if(includeSteps) exp =
`Step 1: Use a = (v - v₀) / t
Step 2: Substitute: a = (${v} - ${v0}) / ${t}
Step 3: Calculate numerator: ${v-v0}
Step 4: Divide: a = ${v-v0} / ${t} = ${ans}`;
            }
            else if(!isNaN(v)&&!isNaN(v0)&&!isNaN(d)&&d!==0) {
              ans=(v*v-v0*v0)/(2*d);
              if(includeSteps) exp =
`Step 1: Use v² = v₀² + 2a·d, rearrange for a
Step 2: a = (v² - v₀²) / (2d)
Step 3: Substitute: a = (${v}² - ${v0}²) / (2×${d})
Step 4: Calculate numerator: ${v*v} - ${v0*v0} = ${v*v-v0*v0}
Step 5: Calculate denominator: 2×${d} = ${2*d}
Step 6: Divide: a = ${v*v-v0*v0} / ${2*d} = ${ans}`;
            }
            break;
          case "t":
            if(!isNaN(v)&&!isNaN(v0)&&!isNaN(a)&&a!==0) {
              ans=(v-v0)/a;
              if(includeSteps) exp =
`Step 1: Use t = (v - v₀) / a
Step 2: Substitute: t = (${v} - ${v0}) / ${a}
Step 3: Calculate numerator: ${v-v0}
Step 4: Divide: t = ${v-v0} / ${a} = ${ans}`;
            }
            else {
              const A=0.5*a,B=v0,C=-d;
              const disc=B*B-4*A*C;
              if(disc<0) throw "No real";
              const t1=(-B+Math.sqrt(disc))/(2*A),
                    t2=(-B-Math.sqrt(disc))/(2*A);
              ans=(t1>=0?t1:t2);
              if(includeSteps) exp =
`Step 1: Use d = v₀·t + ½·a·t² (quadratic in t)
Step 2: Rearranged: ½a·t² + v₀·t - d = 0
Step 3: Use quadratic formula: t = [-v₀ ± √(v₀² - 4·½a·(-d))] / (2·½a)
Step 4: Substitute: a = ${a}, v₀ = ${v0}, d = ${d}
Step 5: Discriminant: ${v0}² - 4×${0.5*a}×${-d} = ${disc}
Step 6: Roots: t₁ = ${t1}, t₂ = ${t2}
Step 7: Choose positive root: t = ${ans}`;
            }
            break;
          case "d":
            if(!isNaN(v0)&&!isNaN(a)&&!isNaN(t)) {
              ans=v0*t+0.5*a*t*t;
              if(includeSteps) exp =
`Step 1: Use d = v₀·t + ½·a·t²
Step 2: Substitute: d = ${v0}×${t} + 0.5×${a}×${t}²
Step 3: Calculate v₀·t: ${v0*t}
Step 4: Calculate 0.5·a·t²: 0.5×${a}×${t*t} = ${0.5*a*t*t}
Step 5: Add: d = ${v0*t} + ${0.5*a*t*t} = ${ans}`;
            }
            else if(!isNaN(v)&&!isNaN(v0)&&!isNaN(a)) {
              ans=(v*v-v0*v0)/(2*a);
              if(includeSteps) exp =
`Step 1: Use v² = v₀² + 2a·d, rearrange for d
Step 2: d = (v² - v₀²) / (2a)
Step 3: Substitute: d = (${v}² - ${v0}²) / (2×${a})
Step 4: Calculate numerator: ${v*v} - ${v0*v0} = ${v*v-v0*v0}
Step 5: Calculate denominator: 2×${a} = ${2*a}
Step 6: Divide: d = ${v*v-v0*v0} / ${2*a} = ${ans}`;
            }
            break;
        }
      }catch(e){ document.getElementById("dk-result").innerText="Error:"+e; return; }
      const out=isNaN(ans)?"Inconsistent data.":`Solved ${x} = ${formatNumber(ans)}`;
      document.getElementById("dk-result").innerText = includeSteps && exp ? out + "\n\n" + exp : out;
    }
    ///////////////////////////////
    // ENERGY & MOMENTUM SOLVER  //
    ///////////////////////////////
    function updateEnergyInputs() {
      const sf=document.getElementById("solve-energy").value;
      const div=document.getElementById("energy-input-fields");
      div.innerHTML="";
      const map={
        ke:["Mass (kg)","Velocity (m/s)"],
        pe:["Mass (kg)","Height (m)"],
        p :["Mass (kg)","Velocity (m/s)"],
        impulse:["Force (N)","Time (s)"]
      };
      map[sf].forEach((txt,i)=>{
        div.innerHTML+=`<label>${txt}<input type="number" id="energy-input-${i}" required></label>`;
      });
    }
    function solveEnergyMomentum() {
      const sf=document.getElementById("solve-energy").value;
      const vals=[...document.querySelectorAll("#energy-input-fields input")]
                 .map(i=>parseFloat(i.value));
      let res="",exp="";
      try{
        switch(sf){
          case "ke": {
            var out=0.5*vals[0]*Math.pow(vals[1],2);
            res=`KE=0.5×${vals[0]}×${vals[1]}²=${formatNumber(out)}J`;
            if (includeSteps) {
              exp =
`Step 1: Write the kinetic energy formula:
    KE = ½·m·v²

Step 2: Identify the known values:
    m = ${vals[0]} kg (mass)
    v = ${vals[1]} m/s (velocity)

Step 3: Substitute the values:
    KE = 0.5 × ${vals[0]} × (${vals[1]})²

Step 4: Calculate v²:
    (${vals[1]})² = ${Math.pow(vals[1],2)}

Step 5: Multiply by mass and 0.5:
    KE = 0.5 × ${vals[0]} × ${Math.pow(vals[1],2)} = ${0.5*vals[0]*Math.pow(vals[1],2)}

Step 6: Final answer:
    KE = ${formatNumber(out)} J`;
            }
            break;
          }
          case "pe": {
            var out=vals[0]*9.81*vals[1];
            res=`PE=${vals[0]}×9.81×${vals[1]}=${formatNumber(out)}J`;
            if (includeSteps) {
              exp =
`Step 1: Write the gravitational potential energy formula:
    PE = m·g·h

Step 2: Identify the known values:
    m = ${vals[0]} kg (mass)
    g = 9.81 m/s² (acceleration due to gravity)
    h = ${vals[1]} m (height)

Step 3: Substitute the values:
    PE = ${vals[0]} × 9.81 × ${vals[1]}

Step 4: Multiply all terms:
    PE = ${vals[0]*9.81*vals[1]}

Step 5: Final answer:
    PE = ${formatNumber(out)} J`;
            }
            break;
          }
          case "p": {
            var out=vals[0]*vals[1];
            res=`p=${vals[0]}×${vals[1]}=${formatNumber(out)}kg·m/s`;
            if (includeSteps) {
              exp =
`Step 1: Write the momentum formula:
    p = m·v

Step 2: Identify the known values:
    m = ${vals[0]} kg (mass)
    v = ${vals[1]} m/s (velocity)

Step 3: Substitute the values:
    p = ${vals[0]} × ${vals[1]}

Step 4: Multiply:
    p = ${out}

Step 5: Final answer:
    p = ${formatNumber(out)} kg·m/s`;
            }
            break;
          }
          case "impulse": {
            var out=vals[0]*vals[1];
            res=`J=${vals[0]}×${vals[1]}=${formatNumber(out)}Ns`;
            if (includeSteps) {
              exp =
`Step 1: Write the impulse formula:
    J = F·Δt

Step 2: Identify the known values:
    F = ${vals[0]} N (force)
    Δt = ${vals[1]} s (time interval)

Step 3: Substitute the values:
    J = ${vals[0]} × ${vals[1]}

Step 4: Multiply:
    J = ${out}

Step 5: Final answer:
    J = ${formatNumber(out)} Ns`;
            }
            break;
          }
        }
      }catch(e){ res="Error:"+e; }
      document.getElementById("energyResult").innerText =
        includeSteps && exp ? res+"\n\n"+exp : res;
    }
    ///////////////////////
    // FIELDS SOLVER     //
    ///////////////////////
    function updateFieldsInputs(){
      const sf=document.getElementById("solve-fields").value;
      const div=document.getElementById("fields-input-fields");
      div.innerHTML="";
      if(sf==="grav"){
        div.innerHTML+=`<label>Mass1(kg)<input type="number" id="fields-input-0" required></label>`;
        div.innerHTML+=`<label>Mass2(kg)<input type="number" id="fields-input-1" required></label>`;
        div.innerHTML+=`<label>Dist(m)<input type="number" id="fields-input-2" required></label>`;
      } else {
        div.innerHTML+=`<label>Charge(C)<input type="number" id="fields-input-0" required></label>`;
        div.innerHTML+=`<label>Dist(m)<input type="number" id="fields-input-1" required></label>`;
      }
    }
    function solveFields(){
      const sf=document.getElementById("solve-fields").value;
      let res="",exp="";
      try{
        if(sf==="grav"){
          const m1=parseFloat(document.getElementById("fields-input-0").value),
                m2=parseFloat(document.getElementById("fields-input-1").value),
                r =parseFloat(document.getElementById("fields-input-2").value),
                G =6.67430e-11,
                F =G*m1*m2/Math.pow(r,2);
          res=`F=${G}×(${m1}×${m2})/(${r}²)=${formatNumber(F)}N`;
          if (includeSteps) {
            exp =
`Step 1: Write Newton's law of universal gravitation:
    F = G·m₁·m₂ / r²

Step 2: Identify the known values:
    G = 6.67430×10⁻¹¹ N·m²/kg² (gravitational constant)
    m₁ = ${m1} kg
    m₂ = ${m2} kg
    r = ${r} m (distance)

Step 3: Substitute the values:
    F = 6.67430e-11 × ${m1} × ${m2} / (${r})²

Step 4: Calculate numerator:
    6.67430e-11 × ${m1} × ${m2} = ${G*m1*m2}

Step 5: Calculate denominator:
    (${r})² = ${Math.pow(r,2)}

Step 6: Divide numerator by denominator:
    F = ${G*m1*m2} / ${Math.pow(r,2)} = ${F}

Step 7: Final answer:
    F = ${formatNumber(F)} N`;
          }
        } else {
          const Q=parseFloat(document.getElementById("fields-input-0").value),
                r =parseFloat(document.getElementById("fields-input-1").value),
                k =8.98755e9,
                E =k*Q/Math.pow(r,2);
          res=`E=${k}×${Q}/(${r}²)=${formatNumber(E)}N/C`;
          if (includeSteps) {
            exp =
`Step 1: Write the electric field formula for a point charge:
    E = k·Q / r²

Step 2: Identify the known values:
    k = 8.98755×10⁹ N·m²/C² (Coulomb's constant)
    Q = ${Q} C (charge)
    r = ${r} m (distance)

Step 3: Substitute the values:
    E = 8.98755e9 × ${Q} / (${r})²

Step 4: Calculate denominator:
    (${r})² = ${Math.pow(r,2)}

Step 5: Calculate numerator:
    8.98755e9 × ${Q} = ${k*Q}

Step 6: Divide numerator by denominator:
    E = ${k*Q} / ${Math.pow(r,2)} = ${E}

Step 7: Final answer:
    E = ${formatNumber(E)} N/C`;
          }
        }
      }catch(e){ res="Error:"+e; }
      document.getElementById("fieldsResult").innerText =
        includeSteps && exp ? res+"\n\n"+exp : res;
    }
    ///////////////////////
    // WAVES SOLVER      //
    ///////////////////////
    function updateWavesInputs(){
      const sf=document.getElementById("solve-waves").value;
      const div=document.getElementById("waves-input-fields");
      div.innerHTML="";
      if(sf==="v"){
        div.innerHTML+=`<label>Freq(Hz)<input type="number" id="waves-input-0" required></label>`;
        div.innerHTML+=`<label>λ(m)<input type="number" id="waves-input-1" required></label>`;
      } else if(sf==="f"){
        div.innerHTML+=`<label>v(m/s)<input type="number" id="waves-input-0" required></label>`;
        div.innerHTML+=`<label>λ(m)<input type="number" id="waves-input-1" required></label>`;
      } else {
        div.innerHTML+=`<label>v(m/s)<input type="number" id="waves-input-0" required></label>`;
        div.innerHTML+=`<label>Freq(Hz)<input type="number" id="waves-input-1" required></label>`;
      }
    }
    function solveWaves(){
      const sf=document.getElementById("solve-waves").value;
      const vals=[...document.querySelectorAll("#waves-input-fields input")]
                 .map(i=>parseFloat(i.value));
      let res="",exp="";
      try{
        if(sf==="v"){
          var out=vals[0]*vals[1];
          res=`v=${vals[0]}×${vals[1]}=${formatNumber(out)}m/s`;
          if (includeSteps) {
            exp =
`Step 1: Write the wave speed formula:
    v = f·λ

Step 2: Identify the known values:
    f = ${vals[0]} Hz (frequency)
    λ = ${vals[1]} m (wavelength)

Step 3: Substitute the values:
    v = ${vals[0]} × ${vals[1]}

Step 4: Multiply:
    v = ${out}

Step 5: Final answer:
    v = ${formatNumber(out)} m/s`;
          }
        } else if(sf==="f"){
          if(vals[1]===0) throw "λ=0";
          var out=vals[0]/vals[1];
          res=`f=${vals[0]}/${vals[1]}=${formatNumber(out)}Hz`;
          if (includeSteps) {
            exp =
`Step 1: Rearrange the wave speed formula for frequency:
    f = v / λ

Step 2: Identify the known values:
    v = ${vals[0]} m/s (wave speed)
    λ = ${vals[1]} m (wavelength)

Step 3: Substitute the values:
    f = ${vals[0]} / ${vals[1]}

Step 4: Divide:
    f = ${out}

Step 5: Final answer:
    f = ${formatNumber(out)} Hz`;
          }
        } else {
          if(vals[1]===0) throw "f=0";
          var out=vals[0]/vals[1];
          res=`λ=${vals[0]}/${vals[1]}=${formatNumber(out)}m`;
          if (includeSteps) {
            exp =
`Step 1: Rearrange the wave speed formula for wavelength:
    λ = v / f

Step 2: Identify the known values:
    v = ${vals[0]} m/s (wave speed)
    f = ${vals[1]} Hz (frequency)

Step 3: Substitute the values:
    λ = ${vals[0]} / ${vals[1]}

Step 4: Divide:
    λ = ${out}

Step 5: Final answer:
    λ = ${formatNumber(out)} m`;
          }
        }
      }catch(e){ res="Error:"+e; }
      document.getElementById("wavesResult").innerText =
        includeSteps && exp ? res+"\n\n"+exp : res;
    }
    /////////////////////////////
    // MODERN PHYSICS SOLVER   //
    /////////////////////////////
    function updateModernInputs(){
      const sf=document.getElementById("solve-modern").value;
      const div=document.getElementById("modern-input-fields");
      div.innerHTML="";
      if(sf==="rke"){
        div.innerHTML+=`<label>Mass(kg)<input type="number" id="modern-input-0" required></label>`;
        div.innerHTML+=`<label>v(m/s)<input type="number" id="modern-input-1" required></label>`;
      } else {
        div.innerHTML+=`<label>Mass(kg)<input type="number" id="modern-input-0" required></label>`;
      }
    }
    function solveModern(){
      const sf=document.getElementById("solve-modern").value;
      const c=3e8;
      let res="",exp="";
      try{
        if(sf==="rke"){
          const m=parseFloat(document.getElementById("modern-input-0").value),
                v=parseFloat(document.getElementById("modern-input-1").value);
          if(v>=c) throw "v≥c";
          const v2 = Math.pow(v,2);
          const c2 = Math.pow(c,2);
          const gamma = 1/Math.sqrt(1-v2/c2);
          const K = (gamma-1)*m*c2;
          res=`K=(${formatNumber(gamma)}-1)×${m}×c²=${formatNumber(K)}J`;
          if (includeSteps) {
            exp =
`Step 1: Write the relativistic kinetic energy formula:
    K = (γ - 1)·m·c²

Step 2: Calculate γ (Lorentz factor):
    γ = 1 / √(1 - v² / c²)
      = 1 / √(1 - (${v}² / ${c}²))
      = 1 / √(1 - (${v2} / ${c2}))
      = 1 / √(${1 - v2 / c2})
      = ${gamma}

Step 3: Subtract 1 from γ:
    γ - 1 = ${gamma} - 1 = ${gamma-1}

Step 4: Multiply by mass and c²:
    (${gamma-1}) × ${m} × (${c}²) = (${gamma-1}) × ${m} × ${c2} = ${K}

Step 5: Final answer:
    K = ${formatNumber(K)} J`;
          }
        } else {
          const m=parseFloat(document.getElementById("modern-input-0").value),
                c2 = Math.pow(c,2),
                E=m*c2;
          res=`E=${m}×c²=${formatNumber(E)}J`;
          if (includeSteps) {
            exp =
`Step 1: Write the rest energy formula:
    E = m·c²

Step 2: Substitute the known values:
    E = ${m} × (${c})²

Step 3: Calculate c²:
    c² = (${c}) × (${c}) = ${c2}

Step 4: Multiply by mass:
    E = ${m} × ${c2} = ${E}

Step 5: Final answer:
    E = ${formatNumber(E)} J`;
          }
        }
      }catch(e){ res="Error:"+e; }
      document.getElementById("modernResult").innerText =
        includeSteps && exp ? res+"\n\n"+exp : res;
    }
    ///////////////////////
    // GRAPHING SECTION  //
    ///////////////////////
    function plotGraph(){
      const type=document.getElementById("graph-type").value;
      const tArr=document.getElementById("graph-time").value.split(",").map(n=>parseFloat(n.trim()));
      const vArr=document.getElementById("graph-value").value.split(",").map(n=>parseFloat(n.trim()));
      if(tArr.length!==vArr.length){ alert("Time/value mismatch"); return; }
      let X=[],Y=[],lbl="";
      if(type==="vt"){ X=tArr; Y=vArr; lbl="Velocity (m/s)"; }
      else if(type==="at"){
        if(tArr.length<2){ alert("Need≥2"); return; }
        for(let i=0;i<tArr.length-1;i++){
          const dt=tArr[i+1]-tArr[i];
          if(dt===0){ alert("Time must increase"); return; }
          X.push((tArr[i]+tArr[i+1])/2);
          Y.push((vArr[i+1]-vArr[i])/dt);
        }
        lbl="Acceleration (m/s²)";
      } else {
        if(tArr.length<2){ alert("Need≥2"); return; }
        X=tArr; Y=[0];
        for(let i=1;i<tArr.length;i++){
          const dt=tArr[i]-tArr[i-1],
                avg=(vArr[i-1]+vArr[i])/2;
          Y.push(Y[i-1]+avg*dt);
        }
        lbl="Displacement (m)";
      }
      if(chart) chart.destroy();
      const ctx=document.getElementById("graphCanvas").getContext("2d");
      chart=new Chart(ctx,{
        type:"line",
        data:{ labels:X,
               datasets:[{
                 label:lbl, data:Y,
                 backgroundColor:"rgba(75,121,161,0.2)",
                 borderColor:"rgba(75,121,161,1)",
                 borderWidth:2,tension:0.1,fill:true
               }]
        },
        options:{ scales:{
          x:{ title:{ display:true,text:"Time (s)" }},
          y:{ title:{ display:true,text:lbl }}
        }}
      });
    }

    ///////////////////////
    // UNIT CONVERTER    //
    ///////////////////////
    function updateConverterInputs(){
      const type=document.getElementById("conversion-type").value;
      const div=document.getElementById("converter-input-fields");
      div.innerHTML="";
      if(type==="speed"){
        div.innerHTML=`
          <label>Select:<select id="speed-direction">
            <option value="kmToMs">km/hr→m/s</option>
            <option value="msToKm">m/s→km/hr</option>
          </select></label>
          <label>Value:<input type="number" id="conversion-input" placeholder="Enter value"></label>`;
      }
      else if(type==="distance"){
        div.innerHTML=`
          <label>Select:<select id="distance-direction">
            <option value="kmToM">km→m</option>
            <option value="mToKm">m→km</option>
            <option value="kmToMi">km→mi</option>
            <option value="miToKm">mi→km</option>
            <option value="mToFt">m→ft</option>
            <option value="ftToM">ft→m</option>
          </select></label>
          <label>Value:<input type="number" id="conversion-input" placeholder="Enter value"></label>`;
      }
      else if(type==="temperature"){
        div.innerHTML=`
          <label>Select:<select id="temp-direction">
            <option value="cToF">°C→°F</option>
            <option value="fToC">°F→°C</option>
            <option value="cToK">°C→K</option>
            <option value="kToC">K→°C</option>
          </select></label>
          <label>Value:<input type="number" id="conversion-input" placeholder="Enter value"></label>`;
      }
      else if(type==="energy"){
        div.innerHTML=`
          <label>Select:<select id="energy-direction">
            <option value="joulesToEv">J→eV</option>
            <option value="evToJoules">eV→J</option>
            <option value="joulesToCal">J→cal</option>
            <option value="calToJoules">cal→J</option>
            <option value="joulesToWh">J→Wh</option>
            <option value="whToJoules">Wh→J</option>
          </select></label>
          <label>Value:<input type="number" id="conversion-input" placeholder="Enter value"></label>`;
      }
      else if(type==="mass"){
        div.innerHTML=`
          <label>Select:<select id="mass-direction">
            <option value="kgToLb">kg→lb</option>
            <option value="lbToKg">lb→kg</option>
            <option value="kgToG">kg→g</option>
            <option value="gToKg">g→kg</option>
            <option value="lbToOz">lb→oz</option>
            <option value="ozToLb">oz→lb</option>
          </select></label>
          <label>Value:<input type="number" id="conversion-input" placeholder="Enter value"></label>`;
      }
      else if(type==="volume"){
        div.innerHTML=`
          <label>Select:<select id="volume-direction">
            <option value="lToM3">L→m³</option>
            <option value="m3ToL">m³→L</option>
            <option value="lToGal">L→gal</option>
            <option value="galToL">gal→L</option>
          </select></label>
          <label>Value:<input type="number" id="conversion-input" placeholder="Enter value"></label>`;
      }
      else if(type === "pressure") {
        div.innerHTML = `
          <label>Select:<select id="pressure-direction">
            <option value="kPaToAtm">kPa→atm</option>
            <option value="atmToKPa">atm→kPa</option>
            <option value="kPaToPsi">kPa→psi</option>
            <option value="psiToKPa">psi→kPa</option>
          </select></label>
          <label>Value:<input type="number" id="conversion-input" placeholder="Enter value"></label>
        `;
      }
      else if(type === "force") {
        div.innerHTML = `
          <label>Select:<select id="force-direction">
            <option value="ntToKgf">N→kgf</option>
            <option value="kgfToNt">kgf→N</option>
          </select></label>
          <label>Value:<input type="number" id="conversion-input" placeholder="Enter value"></label>
        `;
      }
      else if(type === "power") {
        div.innerHTML = `
          <label>Select:<select id="power-direction">
            <option value="wToHp">W→hp</option>
            <option value="hpToW">hp→W</option>
          </select></label>
          <label>Value:<input type="number" id="conversion-input" placeholder="Enter value"></label>
        `;
      }
      else if(type === "area") {
        div.innerHTML = `
          <label>Select:<select id="area-direction">
            <option value="m2ToFt2">m²→ft²</option>
            <option value="ft2ToM2">ft²→m²</option>
            <option value="km2ToMi2">km²→mi²</option>
            <option value="mi2ToKm2">mi²→km²</option>
          </select></label>
          <label>Value:<input type="number" id="conversion-input" placeholder="Enter value"></label>
        `;
      }
    }
    function performConversion() {
      const type = document.getElementById("conversion-type").value;
      const inputVal = parseFloat(document.getElementById("conversion-input").value);
      let result = "";
      if (isNaN(inputVal)) {
        alert("Enter a valid number.");
        return;
      }
      if (type === "speed") {
        const dir = document.getElementById("speed-direction").value;
        result = dir === "kmToMs"
          ? `${inputVal} km/hr = ${formatNumber(inputVal/3.6)} m/s`
          : `${inputVal} m/s = ${formatNumber(inputVal*3.6)} km/hr`;
      }
      else if (type === "distance") {
        const dir = document.getElementById("distance-direction").value;
        if      (dir === "kmToM")   result = `${inputVal} km = ${formatNumber(inputVal*1000)} m`;
        else if (dir === "mToKm")   result = `${inputVal} m = ${formatNumber(inputVal/1000)} km`;
        else if (dir === "kmToMi")  result = `${inputVal} km = ${formatNumber(inputVal*0.621371)} mi`;
        else if (dir === "miToKm")  result = `${inputVal} mi = ${formatNumber(inputVal/0.621371)} km`;
        else if (dir === "mToFt")   result = `${inputVal} m = ${formatNumber(inputVal*3.28084)} ft`;
        else if (dir === "ftToM")   result = `${inputVal} ft = ${formatNumber(inputVal/3.28084)} m`;
      }
      else if (type === "temperature") {
        const dir = document.getElementById("temp-direction").value;
        if      (dir === "cToF") result = `${inputVal}°C = ${formatNumber(inputVal*9/5+32)}°F`;
        else if (dir === "fToC") result = `${inputVal}°F = ${formatNumber((inputVal-32)*5/9)}°C`;
        else if (dir === "cToK") result = `${inputVal}°C = ${formatNumber(inputVal+273.15)} K`;
        else if (dir === "kToC") result = `${inputVal} K = ${formatNumber(inputVal-273.15)}°C`;
      }
      else if (type === "energy") {
        const dir = document.getElementById("energy-direction").value;
        if      (dir === "joulesToEv")  result = `${inputVal} J = ${formatNumber(inputVal/1.60218e-19)} eV`;
        else if (dir === "evToJoules")  result = `${inputVal} eV = ${formatNumber(inputVal*1.60218e-19)} J`;
        else if (dir === "joulesToCal") result = `${inputVal} J = ${formatNumber(inputVal/4.184)} cal`;
        else if (dir === "calToJoules") result = `${inputVal} cal = ${formatNumber(inputVal*4.184)} J`;
        else if (dir === "joulesToWh")  result = `${inputVal} J = ${formatNumber(inputVal/3600)} Wh`;
        else if (dir === "whToJoules")  result = `${inputVal} Wh = ${formatNumber(inputVal*3600)} J`;
      }
      else if (type === "mass") {
        const dir = document.getElementById("mass-direction").value;
        if      (dir === "kgToLb")  result = `${inputVal} kg = ${formatNumber(inputVal*2.20462)} lb`;
        else if (dir === "lbToKg")  result = `${inputVal} lb = ${formatNumber(inputVal/2.20462)} kg`;
        else if (dir === "kgToG")   result = `${inputVal} kg = ${formatNumber(inputVal*1000)} g`;
        else if (dir === "gToKg")   result = `${inputVal} g = ${formatNumber(inputVal/1000)} kg`;
        else if (dir === "lbToOz")  result = `${inputVal} lb = ${formatNumber(inputVal*16)} oz`;
        else if (dir === "ozToLb")  result = `${inputVal} oz = ${formatNumber(inputVal/16)} lb`;
      }
      else if (type === "volume") {
        const dir = document.getElementById("volume-direction").value;
        if      (dir === "lToM3")  result = `${inputVal} L = ${formatNumber(inputVal/1000)} m³`;
        else if (dir === "m3ToL")  result = `${inputVal} m³ = ${formatNumber(inputVal*1000)} L`;
        else if (dir === "lToGal") result = `${inputVal} L = ${formatNumber(inputVal/3.78541)} gal`;
        else if (dir === "galToL") result = `${inputVal} gal = ${formatNumber(inputVal*3.78541)} L`;
      }
      else if (type === "pressure") {
        const dir = document.getElementById("pressure-direction").value;
        if      (dir === "kPaToAtm") result = `${inputVal} kPa = ${formatNumber(inputVal/101.325)} atm`;
        else if (dir === "atmToKPa") result = `${inputVal} atm = ${formatNumber(inputVal*101.325)} kPa`;
        else if (dir === "kPaToPsi") result = `${inputVal} kPa = ${formatNumber(inputVal/6.89476)} psi`;
        else if (dir === "psiToKPa") result = `${inputVal} psi = ${formatNumber(inputVal*6.89476)} kPa`;
      }
      else if (type === "force") {
        const dir = document.getElementById("force-direction").value;
        if      (dir === "ntToKgf") result = `${inputVal} N = ${formatNumber(inputVal/9.80665)} kgf`;
        else if (dir === "kgfToNt") result = `${inputVal} kgf = ${formatNumber(inputVal*9.80665)} N`;
      }
      else if (type === "power") {
        const dir = document.getElementById("power-direction").value;
        if      (dir === "wToHp") result = `${inputVal} W = ${formatNumber(inputVal/745.7)} hp`;
        else if (dir === "hpToW") result = `${inputVal} hp = ${formatNumber(inputVal*745.7)} W`;
      }
      else if (type === "area") {
        const dir = document.getElementById("area-direction").value;
        if      (dir === "m2ToFt2") result = `${inputVal} m² = ${formatNumber(inputVal*10.7639)} ft²`;
        else if (dir === "ft2ToM2") result = `${inputVal} ft² = ${formatNumber(inputVal/10.7639)} m²`;
        else if (dir === "km2ToMi2") result = `${inputVal} km² = ${formatNumber(inputVal*0.386102)} mi²`;
        else if (dir === "mi2ToKm2") result = `${inputVal} mi² = ${formatNumber(inputVal/0.386102)} km²`;
      }
      document.getElementById("converterResult").innerText = result;
    }
    ///////////////////////
    // PRACTICE / QUIZ   //
    ///////////////////////
    function generatePracticeProblem() {
      const cat = document.getElementById("practice-category").value;
      let text="", ans=0;
      if (cat === "kinematics") {
        const type = Math.floor(Math.random()*3);
        if (type===0) {
          const v0=(Math.random()*10).toFixed(1),
                a =(Math.random()*5).toFixed(1),
                t =(Math.random()*5+1).toFixed(1);
          ans = parseFloat(v0)+parseFloat(a)*parseFloat(t);
          text=`Car starts at ${v0} m/s, accel ${a} m/s² for ${t} s. Find final v.`;
        }
        else if (type===1) {
          const v0=(Math.random()*10).toFixed(1),
                a =(Math.random()*5).toFixed(1),
                t =(Math.random()*5+1).toFixed(1);
          ans = parseFloat(v0)*parseFloat(t)+0.5*parseFloat(a)*t*t;
          text=`Object at ${v0} m/s, accel ${a} m/s² for ${t} s. Find displacement.`;
        }
        else {
          const v0=(Math.random()*10).toFixed(1),
                v =(parseFloat(v0)+Math.random()*10+1).toFixed(1),
                a =(Math.random()*5+1).toFixed(1);
          ans=(parseFloat(v)-parseFloat(v0))/parseFloat(a);
          text=`Speed up from ${v0} to ${v} m/s at ${a} m/s². Find time.`;
        }
      }
      else if (cat==="energy") {
        const type=Math.floor(Math.random()*2);
        if (type===0) {
          const m=(Math.random()*5+1).toFixed(1),
                v=(Math.random()*10+1).toFixed(1);
          ans=0.5*parseFloat(m)*Math.pow(parseFloat(v),2);
          text=`Mass ${m} kg, speed ${v} m/s. Find KE.`;
        } else {
          const m=(Math.random()*5+1).toFixed(1),
                h=(Math.random()*10+1).toFixed(1);
          ans=parseFloat(m)*9.81*parseFloat(h);
          text=`Mass ${m} kg at height ${h} m. Find PE.`;
        }
      }
      else if (cat==="fields") {
        const type=Math.floor(Math.random()*2);
        if (type===0) {
          const m1=(Math.random()*100+10).toFixed(1),
                m2=(Math.random()*100+10).toFixed(1),
                r =(Math.random()*5+1).toFixed(1),
                G =6.67430e-11;
          ans=G*parseFloat(m1)*parseFloat(m2)/Math.pow(parseFloat(r),2);
          text=`Force between ${m1} kg & ${m2} kg separated by ${r} m.`;
        } else {
          const Q=(Math.random()*1e-5+1e-6),
                r =(Math.random()*2+0.5).toFixed(2),
                k =8.98755e9;
          ans=k*Q/Math.pow(parseFloat(r),2);
          text=`E-field from charge ${Q.toExponential(2)} C at ${r} m.`;
        }
      }
      else if (cat==="waves") {
        const f=(Math.random()*5+1).toFixed(1),
              λ=(Math.random()*2+0.5).toFixed(2);
        ans=parseFloat(f)*parseFloat(λ);
        text=`Frequency ${f} Hz, λ ${λ} m. Find speed.`;
      }
      else if (cat==="modern") {
        const type=Math.floor(Math.random()*2),
              m=(Math.random()*2+0.5).toFixed(3);
        if(type===0) {
          ans=parseFloat(m)*Math.pow(3e8,2);
          text=`Mass ${m} kg. Find rest energy.`;
        } else {
          const frac=(Math.random()*0.5+0.1).toFixed(2),
                v=frac*3e8,
                γ=1/Math.sqrt(1-Math.pow(v/3e8,2));
          ans=(γ-1)*parseFloat(m)*Math.pow(3e8,2);
          text=`Mass ${m} kg at ${frac}c. Find relativistic KE.`;
        }
      }
      currentProblem = { answer: ans };
      document.getElementById("practice-problem").innerText = text;
      document.getElementById("practice-answer").value = "";
      document.getElementById("practice-result").innerText = "";
    }
    function checkPracticeAnswer() {
      const user = parseFloat(document.getElementById("practice-answer").value);
      if (isNaN(user)) { alert("Enter an answer."); return; }
      const correct = currentProblem.answer;
      const tol = Math.abs(correct) * 0.01;
      const msg = Math.abs(user - correct) < tol
        ? `Correct! ≈ ${formatNumber(correct)}`
        : `Incorrect. Correct ≈ ${formatNumber(correct)}`;
      document.getElementById("practice-result").innerText = msg;
    }
    // Hide all sections on load except choose-unit-screen
    window.onload = function() {
      document.querySelectorAll(".section").forEach(s=>s.style.display="none");
      document.getElementById("result-settings").style.display = "none";
    };
  </script>
</body>
</html>
